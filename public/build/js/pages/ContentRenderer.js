export class ContentRenderer{constructor(e){this.callbacks=e}createContentBlock(e){const t=document.createElement("div");switch(t.className="content-block content-"+e,t.dataset.type=e,e){case"text":t.innerHTML='<div class="text-content" contenteditable="true" placeholder="Escribe tu texto aqu√≠..."></div>';break;case"image":t.innerHTML=this.createImageBlock();break;case"gif":t.innerHTML=this.createGifBlock();break;case"video":t.innerHTML=this.createVideoBlock();break;case"code":t.innerHTML=this.createCodeBlock();break;case"quote":t.innerHTML=this.createQuoteBlock();break;case"card":t.innerHTML=this.createCardBlock()}return this.setupBlockEvents(t),t}createImageBlock(){return'\n            <div class="image-upload">\n                <div class="upload-placeholder">\n                    <p>üì∏ Haz clic para subir una imagen</p>\n                    <input type="file" accept="image/*" style="display: none;">\n                </div>\n            </div>\n        '}createGifBlock(){return'\n            <div class="gif-embed">\n                <input type="text" class="gif-url" placeholder="Pega la URL del GIF (Giphy, Tenor, o URL directa)">\n                <div class="gif-preview"></div>\n            </div>\n        '}createVideoBlock(){return'\n            <div class="video-embed">\n                <input type="text" class="video-url" placeholder="Pega la URL del video de YouTube">\n                <div class="video-preview"></div>\n            </div>\n        '}createCodeBlock(){return'\n            <div class="code-editor">\n                <div class="code-header">\n                    <select>\n                        <option value="javascript">JavaScript</option>\n                        <option value="python">Python</option>\n                        <option value="html">HTML</option>\n                        <option value="css">CSS</option>\n                        <option value="php">PHP</option>\n                        <option value="sql">SQL</option>\n                        <option value="bash">Bash</option>\n                    </select>\n                </div>\n                <textarea placeholder="Escribe tu c√≥digo aqu√≠..."></textarea>\n            </div>\n        '}createQuoteBlock(){return'\n            <div class="quote-editor">\n                <div class="quote-text" contenteditable="true" placeholder="Escribe tu cita aqu√≠..."></div>\n                <div class="quote-author" contenteditable="true" placeholder="‚Äî Autor (opcional)"></div>\n            </div>\n        '}createCardBlock(){return'\n            <div class="card-editor">\n                <div class="card-header" contenteditable="true" placeholder="T√≠tulo de la card..."></div>\n                <div class="card-body" contenteditable="true" placeholder="Contenido de la card..."></div>\n                <div class="card-footer" contenteditable="true" placeholder="Footer opcional..."></div>\n            </div>\n        '}setupBlockEvents(e){const t=e.dataset.type;switch(e.addEventListener("click",e=>{e.target.closest(".plus-btn")||e.target.closest(".block-plus-buttons")||e.target.closest(".add-content-modal")||e.target.matches("input, textarea, select, button:not(.plus-btn)")}),t){case"image":this.setupImageBlock(e);break;case"gif":this.setupGifBlock(e);break;case"video":this.setupVideoBlock(e);break;case"code":this.setupCodeBlock(e)}}setupImageBlock(e){const t=e.querySelector('input[type="file"]');e.querySelector(".upload-placeholder").addEventListener("click",e=>{e.stopPropagation(),t.click()}),t.addEventListener("change",t=>{const a=t.target.files[0];a&&this.uploadImage(a,e.querySelector(".image-upload"))})}setupGifBlock(e){const t=e.querySelector(".gif-url"),a=e.querySelector(".gif-preview");t.addEventListener("input",e=>{const t=e.target.value.trim();this.loadGifPreview(t,a)}),t.addEventListener("click",e=>{e.stopPropagation()})}setupVideoBlock(e){const t=e.querySelector(".video-url"),a=e.querySelector(".video-preview");t.addEventListener("input",e=>{const t=e.target.value.trim();this.loadVideoPreview(t,a)}),t.addEventListener("click",e=>{e.stopPropagation()})}setupCodeBlock(e){const t=e.querySelector("select"),a=e.querySelector("textarea");t.addEventListener("click",e=>{e.stopPropagation()}),a.addEventListener("click",e=>{e.stopPropagation()}),a.addEventListener("input",()=>{this.callbacks.updateContentBlocks()}),t.addEventListener("change",()=>{this.callbacks.updateContentBlocks()})}uploadImage(e,t){const a=new FormData;a.append("image",e),t.innerHTML='<div class="upload-loading"><div class="loading-spinner"></div><p>Subiendo imagen...</p></div>',fetch("/admin/blog/upload-image",{method:"POST",body:a}).then(e=>e.json()).then(e=>{if(e.success){const a=document.createElement("img");a.src=e.url,a.alt=e.filename,t.innerHTML="",t.appendChild(a),a.addEventListener("click",e=>{e.stopPropagation(),this.replaceImage(t)}),this.callbacks.updateContentBlocks()}else t.innerHTML='<div class="upload-error">Error al subir la imagen. Intenta nuevamente.</div>'}).catch(e=>{console.error("Error:",e),t.innerHTML='<div class="upload-error">Error al subir la imagen. Verifica tu conexi√≥n.</div>'})}replaceImage(e){const t=document.createElement("input");t.type="file",t.accept="image/*",t.addEventListener("change",t=>{const a=t.target.files[0];a&&this.uploadImage(a,e)}),t.click()}loadGifPreview(e,t){if(e){if(e.includes("giphy.com")){const a=this.extractGiphyId(e);t.innerHTML=a?`<iframe src="https://giphy.com/embed/${a}" width="100%" height="300" frameBorder="0"></iframe>`:'<p style="color: var(--danger-color);">URL de Giphy no v√°lida</p>'}else if(e.includes("tenor.com")){const a=this.extractTenorId(e);t.innerHTML=a?`<iframe src="https://tenor.com/embed/${a}" width="100%" height="300" frameBorder="0"></iframe>`:'<p style="color: var(--danger-color);">URL de Tenor no v√°lida</p>'}else e.match(/\.(gif|webp)$/i)?t.innerHTML=`<img src="${e}" alt="GIF" style="max-width: 100%; height: auto;">`:t.innerHTML='<p style="color: var(--danger-color);">URL de GIF no v√°lida. Usa enlaces de Giphy, Tenor o URLs directas (.gif)</p>';this.callbacks.updateContentBlocks()}else t.innerHTML=""}loadVideoPreview(e,t){if(!e)return void(t.innerHTML="");const a=this.extractYouTubeId(e);t.innerHTML=a?`\n                <iframe width="100%" height="315" \n                        src="https://www.youtube.com/embed/${a}" \n                        frameborder="0" allowfullscreen></iframe>\n            `:'<p style="color: var(--danger-color);">URL de YouTube no v√°lida. Ejemplo: https://www.youtube.com/watch?v=VIDEO_ID</p>',this.callbacks.updateContentBlocks()}extractYouTubeId(e){const t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);return t&&11===t[2].length?t[2]:null}extractGiphyId(e){const t=e.match(/giphy\.com\/gifs\/.*-([a-zA-Z0-9]+)(?:\?|$)/);return t?t[1]:null}extractTenorId(e){const t=e.match(/tenor\.com\/view\/.*-([0-9]+)(?:\?|$)/);return t?t[1]:null}}