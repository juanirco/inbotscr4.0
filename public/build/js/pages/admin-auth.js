export class AdminAuth{constructor(){this.form=null,this.submitButton=null,this.loading=null,this.errorMessage=null,this.usernameInput=null,this.passwordInput=null,this.init()}init(){this.setupElements(),this.setupEventListeners(),this.setupInitialFocus()}setupElements(){this.form=document.getElementById("authForm"),this.submitButton=document.getElementById("submitButton"),this.loading=document.getElementById("loading"),this.errorMessage=document.getElementById("errorMessage"),this.usernameInput=document.getElementById("username"),this.passwordInput=document.getElementById("password"),this.form||console.error("Auth form not found")}setupEventListeners(){this.form&&this.form.addEventListener("submit",t=>this.handleSubmit(t)),[this.usernameInput,this.passwordInput].forEach(t=>{t&&(t.addEventListener("keypress",t=>{"Enter"===t.key&&(t.preventDefault(),this.handleSubmit(t))}),t.addEventListener("input",()=>{this.hideError()}))})}setupInitialFocus(){this.usernameInput&&setTimeout(()=>{this.usernameInput.focus()},100)}async handleSubmit(t){if(t.preventDefault(),this.validateForm()){this.setLoadingState(!0),this.hideError();try{const t=this.usernameInput.value.trim(),e=this.passwordInput.value.trim(),s=await this.authenticateUser(t,e);s.success?this.handleSuccess():this.handleError(s.error||"Usuario o contraseña incorrectos")}catch(t){console.error("Authentication error:",t),this.handleError("Error de conexión. Intenta nuevamente.")}finally{this.setLoadingState(!1)}}}validateForm(){const t=this.usernameInput.value.trim(),e=this.passwordInput.value.trim();return t?e?t.length<3?(this.handleError("El usuario debe tener al menos 3 caracteres"),this.usernameInput.focus(),!1):!(e.length<3)||(this.handleError("La contraseña debe tener al menos 3 caracteres"),this.passwordInput.focus(),!1):(this.handleError("Por favor ingresa tu contraseña"),this.passwordInput.focus(),!1):(this.handleError("Por favor ingresa tu usuario"),this.usernameInput.focus(),!1)}async authenticateUser(t,e){const s=new FormData;s.append("username",t),s.append("password",e);const r=await fetch("/admin/auth",{method:"POST",body:s,headers:{"X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error("HTTP error! status: "+r.status);return await r.json()}handleSuccess(){this.showSuccessMessage(),setTimeout(()=>{window.location.href="/admin/blog"},800)}handleError(t){this.showError(t),this.passwordInput&&(this.passwordInput.value=""),this.usernameInput&&this.usernameInput.focus()}showError(t){this.errorMessage&&(this.errorMessage.textContent=t,this.errorMessage.style.display="block",setTimeout(()=>{this.hideError()},5e3))}hideError(){this.errorMessage&&(this.errorMessage.style.display="none")}showSuccessMessage(){this.errorMessage&&(this.errorMessage.style.background="rgba(0, 255, 136, 0.1)",this.errorMessage.style.borderColor="rgba(0, 255, 136, 0.3)",this.errorMessage.style.color="var(--success-color)",this.errorMessage.textContent="✅ Acceso autorizado. Redirigiendo...",this.errorMessage.style.display="block")}setLoadingState(t){this.loading&&(this.loading.style.display=t?"block":"none"),this.submitButton&&(this.submitButton.disabled=t,this.submitButton.textContent=t?"Verificando...":"Acceder al Admin"),this.usernameInput&&(this.usernameInput.disabled=t),this.passwordInput&&(this.passwordInput.disabled=t)}reset(){this.usernameInput&&(this.usernameInput.value=""),this.passwordInput&&(this.passwordInput.value=""),this.hideError(),this.setLoadingState(!1)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{document.getElementById("authForm")&&(window.adminAuth=new AdminAuth)}):document.getElementById("authForm")&&(window.adminAuth=new AdminAuth);export default AdminAuth;