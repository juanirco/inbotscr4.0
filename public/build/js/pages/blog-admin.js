import{BlogVisualEditor}from"./BlogVisualEditor.js";export class BlogAdmin{constructor(){this.visualEditor=null,this.isFormSubmitting=!1,this.init()}init(){this.setupFormValidation(),this.initializeVisualEditor(),this.setupGlobalFunctions(),this.setupImagePreview(),this.setupNotificationStyles()}initializeVisualEditor(){document.getElementById("visualEditor")&&(this.visualEditor=new BlogVisualEditor,window.contentBlocks&&window.postId&&console.log("Cargando contenido existente para post ID:",window.postId))}setupGlobalFunctions(){window.showNotification=(e,t="info")=>{this.showNotification(e,t)}}setupFormValidation(){const e=document.querySelector(".blog-form");if(!e)return;const t=document.getElementById("title");e.addEventListener("submit",i=>{if(this.isFormSubmitting)return i.preventDefault(),!1;let o=!0;t&&t.value&&t.value.trim()?this.clearFieldError(t):(this.showFieldError(t,"El título es requerido"),o=!1);const r=i.submitter&&i.submitter.value||"publish",n=e.querySelector('select[name="status"]'),s="publish"===r||n&&"published"===n.value;if(this.visualEditor&&s){this.visualEditor.prepareFormSubmission();const e=document.getElementById("content_blocks");e&&e.value&&"[]"!==e.value||(this.showNotification("Agrega contenido antes de publicar","error"),o=!1)}if(!o)return i.preventDefault(),!1;this.visualEditor&&this.visualEditor.prepareFormSubmission(),this.isFormSubmitting=!0;const a=i.submitter||e.querySelector(".btn-primary");if(a){a.disabled=!0;const e=a.textContent;a.textContent=s?"Publicando...":"Guardando...",setTimeout(()=>{a.disabled=!1,a.textContent=e,this.isFormSubmitting=!1},1e4)}return!0}),t&&(t.addEventListener("blur",()=>{t.value.trim()?this.clearFieldError(t):this.showFieldError(t,"El título es requerido")}),t.addEventListener("input",()=>{t.value.trim()&&this.clearFieldError(t),this.generateSlug()}))}generateSlug(){const e=document.getElementById("title");if(!e||!e.value.trim())return;e.value.toLowerCase().trim().replace(/[áàäâã]/g,"a").replace(/[éèëê]/g,"e").replace(/[íìïî]/g,"i").replace(/[óòöôõø]/g,"o").replace(/[úùüû]/g,"u").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}showFieldError(e,t){if(!e)return;this.clearFieldError(e);const i=document.createElement("div");i.className="field-error",i.textContent=t,i.style.cssText="\n            color: var(--danger-color, #dc3545);\n            font-size: 0.85rem;\n            margin-top: 0.25rem;\n            display: block;\n        ",e.style.borderColor="var(--danger-color, #dc3545)",e.parentNode.appendChild(i),e.scrollIntoView({behavior:"smooth",block:"center"})}clearFieldError(e){if(!e)return;const t=e.parentNode.querySelector(".field-error");t&&t.remove(),e.style.borderColor=""}showNotification(e,t="info"){const i=document.querySelector(".notification");i&&i.remove();const o=document.createElement("div");o.className="notification notification-"+t,o.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 12px 20px;\n            border-radius: 4px;\n            color: white;\n            font-weight: 500;\n            z-index: 10000;\n            max-width: 300px;\n            word-wrap: break-word;\n            transform: translateX(100%);\n            transition: transform 0.3s ease;\n        ";const r={success:"#28a745",error:"#dc3545",warning:"#ffc107",info:"#17a2b8"};o.style.backgroundColor=r[t]||r.info,o.textContent=e,document.body.appendChild(o),requestAnimationFrame(()=>{o.style.transform="translateX(0)"}),setTimeout(()=>{o.style.transform="translateX(100%)",setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},300)},5e3)}setupImagePreview(){const e=document.getElementById("featured_image"),t=document.getElementById("imagePreview"),i=document.getElementById("previewImg"),o=document.getElementById("currentImagePreview");e&&e.addEventListener("change",r=>{const n=r.target.files[0];if(n){if(!n.type.startsWith("image/"))return this.showNotification("Por favor selecciona un archivo de imagen válido.","error"),void(e.value="");if(n.size>5242880)return this.showNotification("La imagen es muy grande. Por favor selecciona una imagen menor a 5MB.","error"),void(e.value="");const r=new FileReader;r.onload=e=>{i&&t&&(i.src=e.target.result,t.style.display="block",o&&(o.style.display="none"))},r.readAsDataURL(n)}else t&&(t.style.display="none"),o&&(o.style.display="block")})}setupNotificationStyles(){}}document.addEventListener("DOMContentLoaded",()=>{if(document.getElementById("visualEditor")||document.querySelector(".blog-form")){const e=new BlogAdmin;window.blogAdmin=e}});export default BlogAdmin;