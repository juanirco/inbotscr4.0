export class DataManager{constructor(e,t){this.editor=e,this.contentBlocks=[],this.callbacks=t}loadExistingContent(){window.contentBlocks&&Array.isArray(window.contentBlocks)&&0!==window.contentBlocks.length&&(this.editor.innerHTML="",window.contentBlocks.forEach((e,t)=>{if(e.columns&&Array.isArray(e.columns)){const t=this.callbacks.createRow();e.columns.forEach(e=>{if(e.content_data){const c=this.callbacks.createColumn(),o=this.createContentBlockFromData(e.content_data);o&&(c.appendChild(o),t.appendChild(c))}}),t.children.length>0&&(this.editor.appendChild(t),this.callbacks.updateColumnWidths(t))}}),0===this.editor.children.length&&this.callbacks.showAddContentButton())}createContentBlockFromData(e){if(!e||!e.type)return null;const t=this.callbacks.createContentBlock(e.type);switch(e.blockSize&&(t.classList.remove("block-size-medium"),t.classList.add("block-size-"+e.blockSize)),e.blockAlign&&(t.classList.remove("block-align-center"),t.classList.add("block-align-"+e.blockAlign)),e.type){case"text":if(e.content){const c=t.querySelector(".text-content");c&&(c.innerHTML=e.content,e.textAlign&&c.classList.add("text-align-"+e.textAlign))}break;case"image":if(e.url){const c=t.querySelector(".image-upload");if(c){const t=document.createElement("div");t.className="image-wrapper";const o=document.createElement("img");o.src=e.url,o.alt=e.alt||"";const n=document.createElement("button");n.type="button",n.className="replace-btn",n.innerHTML="ðŸ“·",n.title="Reemplazar imagen",t.appendChild(o),t.appendChild(n),c.innerHTML="",c.appendChild(t),n.addEventListener("click",e=>{const t=c.closest(".content-block");t&&t.classList.contains("selected")&&(e.stopPropagation(),this.callbacks.replaceImage(c))})}}break;case"gif":if(e.url){const c=t.querySelector(".gif-embed"),o=c.querySelector(".gif-url"),n=c.querySelector(".gif-preview");o.value=e.url,this.callbacks.loadGifPreview(e.url,n)}break;case"video":if(e.url){const c=t.querySelector(".video-embed"),o=c.querySelector(".video-url"),n=c.querySelector(".video-preview");o.value=e.url,this.callbacks.loadVideoPreview(e.url,n)}break;case"code":if(e.content||e.language){const c=t.querySelector("textarea"),o=t.querySelector("select");c&&e.content&&(c.value=e.content),o&&e.language&&(o.value=e.language)}break;case"quote":if(e.text||e.author){const c=t.querySelector(".quote-text"),o=t.querySelector(".quote-author");c&&e.text&&(c.innerHTML=e.text),o&&e.author&&(o.innerHTML=e.author)}break;case"card":if(e.header||e.body||e.footer){const c=t.querySelector(".card-header"),o=t.querySelector(".card-body"),n=t.querySelector(".card-footer");c&&e.header&&(c.innerHTML=e.header),o&&e.body&&(o.innerHTML=e.body),n&&e.footer&&(n.innerHTML=e.footer)}}return t}updateContentBlocks(){this.contentBlocks=[];const e=this.editor.querySelectorAll(".content-row"),t=this.editor.querySelectorAll(".content-block:not(.content-row .content-block)");e.forEach((e,t)=>{const c=e.querySelectorAll(".content-column"),o={row:t,columns:[]};c.forEach((e,c)=>{const n=e.querySelector(".content-block");if(n){const e=this.getBlockData(n);o.columns.push({column:c,type:e.type,content:e,content_data:{...e,row:t,column:c}})}}),o.columns.length>0&&this.contentBlocks.push(o)}),t.length>0&&0===e.length&&t.forEach((e,t)=>{const c=this.getBlockData(e);this.contentBlocks.push({row:t,columns:[{column:0,type:c.type,content:c,content_data:{...c,row:t,column:0}}]})});const c=document.getElementById("content_blocks");return c&&(c.value=JSON.stringify(this.contentBlocks)),this.contentBlocks}getBlockData(e){if(!e)return{};const t={type:e.dataset.type||"text"};switch(e.classList.contains("block-size-small")?t.blockSize="small":e.classList.contains("block-size-large")?t.blockSize="large":t.blockSize="medium",e.classList.contains("block-align-left")?t.blockAlign="left":e.classList.contains("block-align-right")?t.blockAlign="right":t.blockAlign="center",t.type){case"text":const c=e.querySelector(".text-content");t.content=c?c.innerHTML:"",t.text=t.content,c&&(c.classList.contains("text-align-left")?t.textAlign="left":c.classList.contains("text-align-right")?t.textAlign="right":t.textAlign="center");break;case"image":const o=e.querySelector("img");o&&(t.url=o.src,t.src=o.src,t.alt=o.alt||"");break;case"gif":const n=e.querySelector(".gif-url");t.url=n?n.value:"";break;case"video":const l=e.querySelector(".video-url");t.url=l?l.value:"";break;case"code":const r=e.querySelector("textarea"),a=e.querySelector("select");t.content=r?r.value:"",t.language=a?a.value:"javascript";break;case"quote":const s=e.querySelector(".quote-text"),i=e.querySelector(".quote-author");t.text=s?s.innerHTML:"",t.author=i?i.innerHTML:"";break;case"card":const u=e.querySelector(".card-header"),d=e.querySelector(".card-body"),h=e.querySelector(".card-footer");t.header=u?u.innerHTML:"",t.body=d?d.innerHTML:"",t.footer=h?h.innerHTML:""}return t}prepareFormSubmission(){return this.updateContentBlocks()}}