export class TextEditor{constructor(t){this.callbacks=t}handleTextFormat(t,e){switch(t.focus(),e){case"bold":document.execCommand("bold");break;case"italic":document.execCommand("italic");break;case"underline":document.execCommand("underline");break;case"link":this.createLink(t)}}createLink(t){const e=window.getSelection();if(!e.toString().trim())return void alert("Selecciona texto para convertir en enlace");const n=prompt("Ingresa la URL:");if(n){const t=e.getRangeAt(0),o=document.createElement("a");o.href=n,o.target="_blank",o.rel="noopener noreferrer";try{t.surroundContents(o)}catch(e){const n=t.extractContents();o.appendChild(n),t.insertNode(o)}e.removeAllRanges(),this.callbacks.updateContentBlocks()}}applyTextColor(t,e){const n=window.getSelection();n.toString().trim()&&(this.applyTextStyle(n,"color",e),this.callbacks.updateContentBlocks())}applyTextSize(t,e){const n=window.getSelection();n.toString().trim()&&(this.applyTextStyle(n,"font",e),this.callbacks.updateContentBlocks())}applyTextAlign(t,e){t.classList.remove("text-align-left","text-align-center","text-align-right"),t.classList.add("text-align-"+e),this.callbacks.updateContentBlocks()}applyTextStyle(t,e,n){if(!t.toString().trim())return;const o=t.getRangeAt(0);let a=o.commonAncestorContainer.nodeType===Node.TEXT_NODE?o.commonAncestorContainer.parentElement:o.commonAncestorContainer;for(;a&&"SPAN"!==a.tagName&&!a.classList.contains("text-content");)a=a.parentElement;a&&"SPAN"===a.tagName&&this.hasStyleClasses(a)?this.updateExistingSpan(a,e,n,o):this.createNewStyledSpan(o,e,n),t.removeAllRanges()}hasStyleClasses(t){return["color-primary","color-secondary","color-accent","color-success","color-warning","color-danger","font-small","font-normal","font-large","font-xl"].some(e=>t.classList.contains(e))}updateExistingSpan(t,e,n,o){if("color"===e?(t.classList.remove("color-primary","color-secondary","color-accent","color-success","color-warning","color-danger"),n&&t.classList.add("color-"+n)):"font"===e&&(t.classList.remove("font-small","font-normal","font-large","font-xl"),n&&t.classList.add("font-"+n)),!this.hasStyleClasses(t)){const e=t.parentNode;for(;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)}}createNewStyledSpan(t,e,n){if(!n)return;const o=document.createElement("span"),a=`${"color"===e?"color":"font"}-${n}`;o.classList.add(a);try{t.surroundContents(o)}catch(e){const n=t.extractContents();o.appendChild(n),t.insertNode(o)}}}