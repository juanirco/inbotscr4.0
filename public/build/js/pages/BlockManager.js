export class BlockManager{constructor(t,e){this.editor=t,this.maxColumns=4,this.selectedBlock=null,this.callbacks=e}showAddContentButton(){if(0===this.editor.children.length){const t=document.createElement("div");t.className="add-content-btn",t.innerHTML='\n                <button type="button" class="main-add-btn">\n                    ‚ûï Agregar contenido\n                </button>\n                <div class="content-options" style="display: none;">\n                    <button type="button" data-type="text">üìù Texto</button>\n                    <button type="button" data-type="image">üñºÔ∏è Imagen</button>\n                    <button type="button" data-type="code">üíª C√≥digo</button>\n                    <button type="button" data-type="quote">üí¨ Cita</button>\n                    <button type="button" data-type="video">üé• Video</button>\n                    <button type="button" data-type="gif">üé≠ GIF</button>\n                    <button type="button" data-type="card">üìÑ Card</button>\n                </div>\n            ',this.editor.appendChild(t),this.setupContentOptions(t)}}setupContentOptions(t){const e=t.querySelector(".main-add-btn"),n=t.querySelector(".content-options"),o=t.querySelectorAll(".content-options button");e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),n.style.display="flex"===n.style.display?"none":"flex"}),o.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const n=e.target.dataset.type;this.addContentBlock(n),t.remove()})})}addPlusButtons(t){const e=t.closest(".content-row"),n=t.closest(".content-column"),o=Array.from(e.children).indexOf(n),s=e.querySelectorAll(".content-column").length;this.removePlusButtons(t);const l=document.createElement("div");l.className="block-plus-buttons";const a=this.createPlusButton("top","‚¨ÜÔ∏è");l.appendChild(a);const c=this.createPlusButton("bottom","‚¨áÔ∏è");if(l.appendChild(c),s<this.maxColumns){const t=this.createPlusButton("left","‚¨ÖÔ∏è");l.appendChild(t)}if(s<this.maxColumns){const t=this.createPlusButton("right","‚û°Ô∏è");l.appendChild(t)}const i=this.createDeleteButton();l.appendChild(i),this.setupPlusButtonEvents(l,t,e,o),this.setupDeleteButtonEvents(l,t),t.appendChild(l)}createPlusButton(t,e){const n=document.createElement("button");return n.type="button",n.className="plus-btn plus-btn-"+t,n.innerHTML='<span class="plus-icon">+</span>',n.title=this.getPlusButtonTitle(t),n.dataset.position=t,n}createDeleteButton(){const t=document.createElement("button");return t.type="button",t.className="delete-btn",t.innerHTML='<span class="delete-icon">√ó</span>',t.title="Eliminar bloque",t}getPlusButtonTitle(t){return{top:"Agregar bloque arriba",bottom:"Agregar bloque abajo",left:"Agregar columna a la izquierda",right:"Agregar columna a la derecha"}[t]||"Agregar bloque"}setupPlusButtonEvents(t,e,n,o){t.querySelectorAll(".plus-btn").forEach(t=>{t.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation();const l=t.dataset.position;this.showAddContentModal(l,e,n,o)})})}setupDeleteButtonEvents(t,e){const n=t.querySelector(".delete-btn");n&&n.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),confirm("¬øEst√°s seguro de eliminar este bloque? Esta acci√≥n no se puede deshacer.")&&this.deleteBlockDirectly(e)})}showAddContentModal(t,e,n,o){const s=document.querySelector(".add-content-modal");s&&s.remove();const l=document.createElement("div");l.className="add-content-modal",l.innerHTML='\n            <div class="modal-overlay"></div>\n            <div class="modal-content">\n                <h3>Seleccionar tipo de contenido</h3>\n                <div class="content-type-grid">\n                    <button type="button" data-type="text" class="content-type-btn">\n                        <span class="icon">üìù</span>\n                        <span class="label">Texto</span>\n                    </button>\n                    <button type="button" data-type="image" class="content-type-btn">\n                        <span class="icon">üñºÔ∏è</span>\n                        <span class="label">Imagen</span>\n                    </button>\n                    <button type="button" data-type="code" class="content-type-btn">\n                        <span class="icon">üíª</span>\n                        <span class="label">C√≥digo</span>\n                    </button>\n                    <button type="button" data-type="quote" class="content-type-btn">\n                        <span class="icon">üí¨</span>\n                        <span class="label">Cita</span>\n                    </button>\n                    <button type="button" data-type="video" class="content-type-btn">\n                        <span class="icon">üé•</span>\n                        <span class="label">Video</span>\n                    </button>\n                    <button type="button" data-type="gif" class="content-type-btn">\n                        <span class="icon">üé≠</span>\n                        <span class="label">GIF</span>\n                    </button>\n                    <button type="button" data-type="card" class="content-type-btn">\n                        <span class="icon">üìÑ</span>\n                        <span class="label">Card</span>\n                    </button>\n                </div>\n                <button type="button" class="modal-close">Cancelar</button>\n            </div>\n        ',document.body.appendChild(l),this.setupModalEvents(l,t,e,n,o)}setupModalEvents(t,e,n,o,s){const l=t.querySelector(".modal-overlay"),a=t.querySelector(".modal-close"),c=t.querySelectorAll(".content-type-btn"),i=()=>t.remove();l.addEventListener("click",i),a.addEventListener("click",i),c.forEach(t=>{t.addEventListener("click",l=>{l.preventDefault();const a=t.dataset.type;this.addContentBlock(a,e,o,s,n),i()})})}addContentBlock(t,e="bottom",n=null,o=null,s=null){const l=this.callbacks.createContentBlock(t);if(l.classList.add("block-size-medium","block-align-center"),"left"===e||"right"===e)this.addColumnToRow(n,l,e,o);else{const t=this.createRow(),o=this.createColumn();o.appendChild(l),t.appendChild(o),"bottom"!==e&&n?"top"===e&&n&&n.parentNode.insertBefore(t,n):n?n.parentNode.insertBefore(t,n.nextSibling):this.editor.appendChild(t)}this.selectBlock(l),this.callbacks.updateToolbarState(),this.callbacks.updateContentBlocks()}addColumnToRow(t,e,n,o){const s=t.querySelectorAll(".content-column");if(s.length>=this.maxColumns)return void alert(`M√°ximo ${this.maxColumns} columnas por fila`);const l=this.createColumn();l.appendChild(e),"left"===n?t.insertBefore(l,s[o]):"right"===n&&(o+1<s.length?t.insertBefore(l,s[o+1]):t.appendChild(l)),this.updateColumnWidths(t),this.callbacks.updateContentBlocks()}updateColumnWidths(t){const e=t.querySelectorAll(".content-column"),n=100/e.length;e.forEach(t=>{t.style.width=n+"%"})}createRow(){const t=document.createElement("div");return t.className="content-row",t}createColumn(){const t=document.createElement("div");return t.className="content-column",t}selectBlock(t){this.editor.querySelectorAll(".content-block.selected").forEach(t=>{t.classList.remove("selected"),this.removePlusButtons(t)}),t.classList.add("selected"),this.selectedBlock=t,this.addPlusButtons(t),this.callbacks.onBlockSelected(t)}removePlusButtons(t){const e=t.querySelector(".block-plus-buttons");e&&e.remove()}removeAllPlusButtons(){this.editor.querySelectorAll(".block-plus-buttons").forEach(t=>{t.remove()})}duplicateBlock(t){const e=t.cloneNode(!0);this.removePlusButtons(e);const n=this.createRow(),o=this.createColumn();o.appendChild(e),n.appendChild(o);const s=t.closest(".content-row");s.parentNode.insertBefore(n,s.nextSibling),this.callbacks.setupBlockEvents(e),this.selectBlock(e),this.callbacks.updateToolbarState(),this.callbacks.updateContentBlocks()}deleteBlockDirectly(t){const e=t.closest(".content-column"),n=e.closest(".content-row");1===n.querySelectorAll(".content-column").length?n.remove():(e.remove(),this.updateColumnWidths(n)),this.selectedBlock=null,this.callbacks.onBlockDeselected(),0===this.editor.children.length&&this.showAddContentButton(),this.callbacks.updateContentBlocks(),window.showNotification&&window.showNotification("Bloque eliminado exitosamente","success")}deleteBlock(t){confirm("¬øEst√°s seguro de eliminar este bloque?")&&this.deleteBlockDirectly(t)}applyBlockSize(t,e){t.classList.remove("block-size-small","block-size-medium","block-size-large"),t.classList.add("block-size-"+e),this.callbacks.updateContentBlocks()}applyBlockAlign(t,e){t.classList.remove("block-align-left","block-align-center","block-align-right"),t.classList.add("block-align-"+e),this.callbacks.updateContentBlocks()}getSelectedBlock(){return this.selectedBlock}clearSelection(){this.selectedBlock&&(this.selectedBlock.classList.remove("selected"),this.removePlusButtons(this.selectedBlock),this.selectedBlock=null)}}